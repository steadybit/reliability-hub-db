# Introduction

Generate a huge file in the filesystem.

# Prerequisites

If you are not using our container images for the extension, you need install the `df` and `fallocate` / `dd`  tool to use the attack.

# Use Cases

    * Fill the host file system to test the behavior of the host when the file system is full.
    * Fill the emphemeral storage to the maximum to test the behavior of the cluster when the emphemeral storage is full.

# Parameters

| Parameter  | Description                                                                                                                                                                         | Default |
|------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| Duration   | How long should disk be filled?                                                                                                                                                     | 30s     |
| Mode       | Define the operational mode. The attack fill disk as <br/> * Overall percentage of filled disk space in percent. <br/> * Megabytes to write <br/> * Megabytes to leave free on disk | PERCENT |
| Size       | Depending on the mode, specify the percentage of filled disk space or the number of Megabytes to be written or left free.                                                           | 80      |
| Path       | Path where the file should be written                                                                                                                                               | /tmp    |
| Method     | Should the disk filled at once or over time? That means use the command fallocate or dd.                                                                                            | AT_ONCE |
| Block Size | Define the block size for writing the file with the dd command. If the block size is larger than the fill value, the fill value will be used as block size.                         | 5       |

# How to use the different methods
## Should the disk filled at once?
If you want to fill the disk at once, the extension uses the fallocate command. The fallocate command is much faster than the dd command.
It allocates the space on the disk without writing any data. The fallocate command is only available on Linux systems.
However, if you want to write more than 100% of the disk space, there are better choices than the fallocate command. Sometimes, it stops allocating space before the disk is full.
When this happens, use the "Over time" method to fill the disk with dd command.

## Should the disk filled over time?
If you want to fill the disk over time, the extension uses the dd command. The dd command is much slower than the fallocate command.
But the dd command writes real data to the disk. The disk is filled with zeros.
This command takes some time but can write up to 100% of the disk space.

# Check if the disk is full
To check if the disk is full, you can use the following command:
```
df -h
```

# Calculation of the fill value
## Percentage
We are using df -kP `filepath` to get the disk usage in kilobytes.
The size to write is calculated as follows:
- diskSpace is the output of df -kP `filepath`
- size is the percentage of the disk space to write

```
diskSpace.Capacity * size / 100 - diskSpace.Used
```

The result is the number of kilobytes to write.
BUT if you check the disk usage with df -h, you could see a different percentage usage. Sometimes the usage is higher than the percentage you specified because of diskSpace.Usage is another value than calculating diskSpace.Capacity - diskSpace.Available.

## Megabytes to leave free on disk
The size to write is calculated as follows:
- size is the number of megabytes to write
- size is the amount of megabytes to leave free on disk

```
diskSpace.Available - size * 1024
```

The result is the number of kilobytes to write.
